resources:
  - ../../base

patches:
  - target:
      kind: Application
      name: cluster-config
    patch: |-
      - op: replace
        path: /spec/source/path
        value: argocd/cluster-config/profiles/keycloak-postgresql
  - target:
      kind: ApplicationSet
      name: cluster-apps
    patch: |-
      # Test that element 1 has the name 'keycloak'
      - op: test
        path: /spec/generators/0/list/elements/1/name
        value: keycloak
      # Replace the path of element 1
      - op: replace
        path: /spec/generators/0/list/elements/1/path
        value: cluster-config/cluster-apps/keycloak/overlays/keycloak-postgresql
